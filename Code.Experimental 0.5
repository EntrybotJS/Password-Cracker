using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Threading;
using System.Diagnostics;

/// <summary>
/// Crackeur de mots de passe Multi-Thread√©
/// Julien Ferluc
/// 2016-10-08
/// </summary>

namespace MultiThreadTest
{
    class Program
    {

        //Initializing some global variables (do not put variables that need to be accessed very often here because it will
        //probably slow down the program and render it somewhat unstable

        static long count;
        static string _crack;
        static string password;
        static int _debut;
        static int _fin;
        static bool fini = false;

        static void Main()
        {

            //start message and setup of password
            Console.ForegroundColor = ConsoleColor.White;
            Console.WriteLine("Program initialized");
            Console.WriteLine("What is the password to guess?");
            password = Console.ReadLine();
            int passLength = password.Length;
            
            Console.Clear();

            //min
            Console.WriteLine("Minimum number of letters? (Example: if word = 4 letters then this would be 4; if lenght of word is unknow we suggest 3 minimum)");
            _debut = int.Parse(Console.ReadLine());
            Console.Clear();

            //max
            Console.WriteLine("Maximum number of letters?");
            _fin = int.Parse(Console.ReadLine());
            _fin = _fin + 1;
            Console.Clear();

            double time = (Math.Pow(26, (_debut + _fin / 2)) / 4700);
            //PID
            int nProcessID = Process.GetCurrentProcess().Id;
            Console.Write(("pid: " + nProcessID));

            //Date
            Console.WriteLine(" Start time: " + DateTime.Now);

            Console.WriteLine("Password lenght = " + passLength);
            Console.WriteLine("Estimation: " + Math.Pow(26, passLength) + " Tries");
            Console.WriteLine("In " + time + " milliseconds");

            Thread worker1 = new Thread(new ThreadStart(Worker1));
            Thread worker2 = new Thread(new ThreadStart(Worker2));
            //Thread worker3 = new Thread(new ThreadStart(Worker3));
            //Thread worker4 = new Thread(new ThreadStart(Worker4));

            worker1.Start();
            worker2.Start();
            //worker3.Start();
            //worker4.Start();

            //Starting stopwatch
            var stopwatch = new Stopwatch();
            stopwatch.Start();

            //Post verification algorithm
            while (true)
            {
                if (fini == true)
                {
                    //Arret du timer et conversion du temps en millisecondes
                    stopwatch.Stop();
                    var elapsed = stopwatch.ElapsedMilliseconds;

                    //Stats et affichage du mot de passe
                    Console.ForegroundColor = ConsoleColor.Green;
                    Console.WriteLine("password: " + _crack);
                    Console.ForegroundColor = ConsoleColor.White;
                    Console.WriteLine(count + " tries in " + elapsed + "ms at " + count / elapsed + " tries/ms");
                    break;
                }
            }
            Console.Read();
        }


        public static void Worker1()
        {
            Console.WriteLine("Thread 1 Initialized");
            int debut = _debut;
            int fin = _fin;
            string crack = "";
            char rand;
            int num;
            int lenght;
            int i = 0;
            Random random = new Random();
            //Generation random d'un pseudo mot de passe et verification sur la thread 1

            do
            {
                crack = "";
                lenght = 0;
                i = 0;
                lenght = random.Next(debut, fin);
                while (i != lenght)
                {
                    num = random.Next(0, 26);
                    rand = (char)('a' + num);
                    crack = crack.Insert(0, rand.ToString());
                    i++;
                }
                count++;
            } while (crack != password);
            _crack = crack;
            fini = true;
        }

        public static void Worker2()
        {
            Console.WriteLine("Thread 2 Initialized");
            int debut = _debut;
            int fin = _fin;
            string crack = "";
            char rand;
            int num;
            int lenght;
            int i = 0;
            Random random = new Random();
            //Generation random d'un pseudo mot de passe et verification sur la thread 1
            do
            {
                crack = "";
                lenght = 0;
                i = 0;
                lenght = random.Next(debut, fin);
                while (i != lenght)
                {
                    num = random.Next(0, 26);
                    rand = (char)('a' + num);
                    crack = crack.Insert(0, rand.ToString());
                    i++;
                }
                count++;
            } while (crack != password);
            count++;
            _crack = crack;
            fini = true;
        }

        public static void Worker3()
        {
            Console.WriteLine("Thread 3 Initialized");
            int debut = _debut;
            int fin = _fin;
            string crack = "";
            char rand;
            int num;
            int lenght;
            int i = 0;
            Random random = new Random();
            //Generation random d'un pseudo mot de passe et verification sur la thread 1
            do
            {
                crack = "";
                lenght = 0;
                i = 0;
                lenght = random.Next(debut, fin);
                while (i != lenght)
                {
                    num = random.Next(0, 26);
                    rand = (char)('a' + num);
                    crack = crack.Insert(0, rand.ToString());
                    i++;
                }
                count++;
            } while (crack != password);
            _crack = crack;
            fini = true;
        }

        public static void Worker4()
        {
            Console.WriteLine("Thread 4 Initialized");
            int debut = _debut;
            int fin = _fin;
            string crack = "";
            char rand;
            int num;
            int lenght;
            int i = 0;
            Random random = new Random();
            //Generation random d'un pseudo mot de passe et verification sur la thread 1
            do
            {
                crack = "";
                lenght = 0;
                i = 0;
                lenght = random.Next(debut, fin);
                while (i != lenght)
                {
                    num = random.Next(0, 26);
                    rand = (char)('a' + num);
                    crack = crack.Insert(0, rand.ToString());
                    i++;
                }
                count++;
            } while (crack != password);
            _crack = crack;
            fini = true;
        }
    }
}
